<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ãƒ¼ãƒˆä¸€è¦§ | æ¨ã—ç³»é£Ÿã¹ç‰©é€šè²©ã‚µã‚¤ãƒˆ</title>
    <style>
        body {
            background-color: #ffd9ef; /* æ¨ã—ã‚«ãƒ©ãƒ¼(ãƒ”ãƒ³ã‚¯) */
            color: #2f4f2f; /* ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚°ãƒªãƒ¼ãƒ³ */
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        main {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        /* --- Header Style --- (ãƒ‡ã‚¶ã‚¤ãƒ³æ”¹å–„) */
        header {
            background-color: #159450;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 0 10px rgba(0,0,0,0.3); /* ã‚ˆã‚Šæ¿ƒã„å½± */
            margin-bottom: 20px;
        }
        header img.home-icon, header .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%; /* æ­£å††ã« */
            cursor: pointer;
            transition: transform 0.3s;
            object-fit: cover; /* ç”»åƒãŒæ­ªã¾ãªã„ã‚ˆã†ã« */
        }
        header img.home-icon:hover {
            transform: rotate(5deg);
        }
        header .user-icon:hover {
            transform: scale(1.1);
        }
        header h1 {
            color: white;
            font-size: 1.8em;
            margin: 0 0 0 15px;
            flex-grow: 1;
        }
        header .left {
            display: flex;
            align-items: center;
        }

        /* --- Button Style --- */
        a.btn, button[type="submit"] {
            background-color: #fff;
            color: #2f4f2f;
            border: 2px solid #2f4f2f;
            padding: 10px 20px;
            margin: 5px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.3s, color 0.3s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        a.btn:hover {
            background-color: #2f4f2f;
            color: #fff;
            transform: translateY(-1px);
        }
        a.btn.primary { /* ãƒ¬ã‚¸ã«é€²ã‚€ãƒœã‚¿ãƒ³ */
            background-color: #2f4f2f;
            color: white;
            border-color: #2f4f2f;
            font-weight: bold;
        }
        a.btn.primary:hover {
            background-color: #159450;
            border-color: #159450;
        }

        /* ====================================
             2. ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« (cart_list.html)
             ==================================== */
        .cart-container {
            text-align: center;
            color: #2f4f2f;
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        table {
            width: 100%;
            margin: 20px auto 0;
            border-collapse: collapse;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #b2d8b2;
            color: #2f4f2f;
            font-weight: 600;
        }
        tbody tr:nth-child(even) {
            background-color: #f8f8f8;
        }
        tbody tr:hover {
            background-color: #e6f7e6;
        }
        .total-row td {
            font-weight: bold;
            background-color: #e6f7e6 !important;
            border-top: 2px solid #2f4f2f;
            font-size: 1.1em;
            color: #2f4f2f;
        }
        .delete-btn {
            background-color: #dc3545;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }

        /* ====================================
             3. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
             ==================================== */
        @media screen and (max-width: 768px) {
            main {
                padding: 10px;
            }
            .cart-container {
                padding: 10px;
                border-radius: 10px;
            }
            table, thead, tbody, th, td, tr {
                display: block;
                width: 100%;
            }
            thead { display: none; } /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éè¡¨ç¤º */

            td {
                /* ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: right;
                border-bottom: 1px solid #eee;
            }

            td::before {
                /* ãƒ©ãƒ™ãƒ«ã¨ã—ã¦thã®å½¹å‰²ã‚’æœãŸã™ */
                content: attr(data-label);
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: #2f4f2f;
            }

            /* å„è¡Œã‚’ã‚«ãƒ¼ãƒ‰ã®ã‚ˆã†ã«è¦‹ã›ã‚‹ */
            tbody tr {
                border: 1px solid #ddd;
                margin-bottom: 15px;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
            /* åˆè¨ˆè¡Œã®èª¿æ•´ */
            .total-row td {
                text-align: right;
                padding-left: 10px; /* ãƒ©ãƒ™ãƒ«ã‚’éè¡¨ç¤ºã«ã™ã‚‹ãŸã‚ */
            }
            .total-row td::before {
                content: none;
            }
            .total-row td:first-child {
                text-align: right;
                font-size: 1.1em;
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <!-- å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="left">
            <a th:href="@{/}">
                <!-- ç”»åƒãŒå­˜åœ¨ã—ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¿½åŠ  -->
                <img src="/images/homebotan.jpg" alt="ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹" class="home-icon" onerror="this.onerror=null;this.src='https://placehold.co/40x40/159450/ffffff?text=HOME';" />
            </a>
            <h1>OshiGiftBox</h1>
        </div>
        <div class="user-links">
            <a th:href="@{/users/auth_select}">
                <!-- ç”»åƒãŒå­˜åœ¨ã—ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¿½åŠ  -->
                <img src="/images/yuza.jpg" alt="ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²" class="user-icon" onerror="this.onerror=null;this.src='https://placehold.co/40x40/159450/ffffff?text=USER';" />
            </a>
        </div>
    </header>
    <main>
        <!-- ğŸ’¡ ä¿®æ­£: æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ  -->
        <div th:if="${successMessage}" style="background-color: #e6ffed; color: #155724; border: 1px solid #c3e6cb; padding: 10px; margin-bottom: 15px; border-radius: 8px; text-align: center;">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" style="background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 10px; margin-bottom: 15px; border-radius: 8px; text-align: center;">
            <span th:text="${errorMessage}"></span>
        </div>
        
        <h1 style="text-align: center; color: #888; margin-top: 0; font-size: 2em; letter-spacing: 1px;">ã‚«ãƒ¼ãƒˆä¸€è¦§</h1>

    <div class="cart-container">
        <h2 style="color: #2f4f2f; font-size: 1.5em; margin-bottom: 20px;">ğŸ›’ ç¾åœ¨ã®ã‚«ãƒ¼ãƒˆå†…å®¹</h2>
        
        <!-- th:with ã§åˆè¨ˆã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°ã‚’ã€é›†è¨ˆé–¢æ•°ã‚’ä½¿ã£ã¦ä¸€åº¦ã«è¨ˆç®—ã™ã‚‹ -->
        <th:block th:with="totalPrice=${#lists.isEmpty(cartItems) ? 0 : #aggregates.sum(cartItems.![product.price * quantity])}">

        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr>
                    <th style="text-align: left; width: 40%;">å•†å“å</th>
                    <th style="text-align: right; width: 15%;">å˜ä¾¡</th>
                    <th style="text-align: center; width: 10%;">æ•°é‡</th>
                    <th style="text-align: right; width: 20%;">å°è¨ˆ</th>
                    <th style="text-align: center; width: 15%;">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <!-- th:each ã®ãƒ«ãƒ¼ãƒ—ã€‚ã“ã“ã§ã¯å°è¨ˆã®ã¿è¨ˆç®— -->
                <tr th:each="item : ${cartItems}" 
                    th:with="subtotal=${item.product.price * item.quantity}">
                    
                    <td th:text="${item.product.name}" data-label="å•†å“å" style="text-align: left;">å•†å“å</td>
                    <td th:text="${#numbers.formatInteger(item.product.price, 1, 'COMMA')} + 'å††'" data-label="å˜ä¾¡" style="text-align: right;">å˜ä¾¡</td>
                    <td th:text="${item.quantity}" data-label="æ•°é‡">æ•°é‡</td>
                    <td th:text="${#numbers.formatInteger(subtotal, 1, 'COMMA')} + 'å††'" data-label="å°è¨ˆ" style="text-align: right;">å°è¨ˆ</td>
                    <td data-label="æ“ä½œ">
                        <!-- ğŸš¨ ä¿®æ­£: å‰Šé™¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®URLã‚’ /cart/{itemId} ã«ä¿®æ­£ -->
                        <form th:action="@{'/cart/' + ${item.id}}" method="post" style="margin: 0;">
                            <input type="hidden" name="_method" value="delete" />
                            <button type="submit" class="delete-btn">
                                å‰Šé™¤
                            </button>
                        </form>
                    </td>
                </tr>

                <!-- åˆè¨ˆé‡‘é¡ã®è¡Œã€‚totalPrice å¤‰æ•°ã‚’å®‰å…¨ã«å‚ç…§ -->
                <tr th:if="${not #lists.isEmpty(cartItems)}" class="total-row">
                    <td colspan="3" style="text-align: right; border: none;">åˆè¨ˆé‡‘é¡</td>
                    <!-- totalPriceã¯th:withã§è¨ˆç®—ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§åˆ©ç”¨ -->
                    <td th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')} + 'å††'" colspan="2" style="text-align: right;">åˆè¨ˆé‡‘é¡</td>
                </tr>

                <tr th:if="${#lists.isEmpty(cartItems)}">
                    <td colspan="5" style="padding: 20px; text-align: center; color: #888; font-style: italic;">ã‚«ãƒ¼ãƒˆã«å•†å“ãŒã‚ã‚Šã¾ã›ã‚“...æ¨ã—æ´»ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</td>
                </tr>
            </tbody>
        </table>
        </th:block>
    </div>
    <div style="text-align: center; margin-top: 30px;">
        <!-- ãƒªãƒ³ã‚¯å…ˆã‚’å•†å“ä¸€è¦§ /products_list ã«ä¿®æ­£ (ProductControllerã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚) -->
        <a th:href="@{/products_list}" class="btn">å•†å“ã‚’è¿½åŠ ã™ã‚‹</a> 
        <a th:href="@{/order/confirm}" class="btn primary">ãƒ¬ã‚¸ã«é€²ã‚€ï¼ˆæ³¨æ–‡ç¢ºå®šã¸ï¼‰</a>
    </div>
    </main>
</body>
</html>